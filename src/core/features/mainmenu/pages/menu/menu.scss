@use "theme/globals" as *;

:host {
    ion-tabs {
        --menutabbar-size: var(--bottom-tabs-size);
    }

    ion-tabs.placement-side {
        --menutabbar-size: var(--side-tabs-size);
    }

    --network-margin-bottom: 0px;
    --network-message-background: transparent;
    --network-message-offline: none;
    --network-message-online: none;
    --network-message-height: 16px;
}

:host-context(.core-online),
:host-context(.core-offline) {
    .core-network-message {
        visibility: visible;
        height: var(--network-message-height);
        line-height: var(--network-message-height);
        padding-bottom: calc(var(--ion-safe-area-bottom, 0px) + var(--network-message-height));
    }
}

:host-context(.core-online) {
    --network-margin-bottom: 8px;
    --network-message-background: var(--success);
    --network-message-online: block;
}

:host-context(.core-offline) {
    --network-margin-bottom: 8px;
    --network-message-background: var(--danger);
    --network-message-offline: block;
}

ion-tab-bar {
    --background: var(--core-bottom-tabs-background);
    --color: var(--core-bottom-tabs-color);
    --color-selected: var(--core-bottom-tabs-color-selected);
    --background-selected: transparent;

    height: var(--menutabbar-size);
    border-top: 1px solid rgba(0, 0, 0, 0.08);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
}

core-user-menu-button {
    align-items: center;
    display: flex;
    justify-content: center;
}

ion-tab-button {
    color: var(--color);
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: visible;

    &::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        width: 56px;
        height: 56px;
        background: var(--color-selected);
        opacity: 0.1;
        border-radius: 16px;
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        z-index: 0;
    }

    &.tab-selected {
        color: var(--color-selected);

        &::before {
            transform: translate(-50%, -50%) scale(1);
        }

        ion-icon.core-tab-icon {
            transform: scale(1.1);
        }

        ion-label {
            font-weight: 600;
        }
    }

    &:active {
        transform: scale(0.95);
    }

    ion-icon.core-tab-icon {
        text-overflow: unset;
        overflow: visible;
        text-align: center;
        font-size: var(--mdl-typography-icon-fontSize-lg);
        transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        position: relative;
        z-index: 1;
    }

    ion-label {
        position: relative;
        z-index: 1;
        transition: font-weight 0.3s ease;
    }

    ion-badge.core-tab-badge {
        font-size: var(--mdl-typography-body-fontSize-sm);
        font-weight: 700;
        border-radius: 12px;
        padding: 2px 7px;
        line-height: 16px;
        min-width: 20px;
        --background: var(--core-bottom-tabs-badge-color);
        --color: var(--core-bottom-tabs-badge-text-color);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        animation: badge-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    ion-icon.core-tab-badge {
        color: var(--core-bottom-tabs-badge-color);
        padding: 3px 6px 2px;
        min-width: 12px;
        font-size: #{dynamic-font(8px)};
        font-weight: normal;
        box-sizing: border-box;
        position: absolute;
        z-index: 2;
        @include position(8px, null, null, calc(50% + 6px));
        animation: badge-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
}

@keyframes badge-pop {
    0% {
        transform: scale(0);
        opacity: 0;
    }
    50% {
        transform: scale(1.2);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

ion-tabs {
    core-loading {
        --loading-placeholder-gap: 12px;
        --loading-placeholder-padding: 4px;
        --loading-placeholder-margin: 0px;
        --loading-placeholder-element-radius: 100%;
        --loading-placeholder-element-width: 44px;
        --loading-placeholder-element-height: 44px;
        --loading-placeholder-element-column-width: 44px;
    }

    &.placement-bottom {
        core-loading {
            --loading-placeholder-align-content: flex-start;
            --loading-placeholder-justify: space-around;
            --loading-placeholder-max-height: 52px;
        }

        ion-tab-button {
            // Removed border-top and border-bottom (the selection dot)
            border: none;

            ion-icon.core-tab-icon {
                margin-bottom: var(--network-margin-bottom);
                transition: margin 0.5s cubic-bezier(0.4, 0, 0.2, 1),
                           transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            }

            ion-icon.core-tab-badge,
            ion-badge.core-tab-badge {
                top: 6px;
            }
        }

        @if ($core-always-show-main-menu) {
            ion-tab-bar {
                height: var(--menutabbar-size) !important;
                visibility: visible !important;
                transform: translateY(0) !important;
            }
        } @else {
            &.tabshidden ion-tab-bar {
                pointer-events: none;
                height: 0px;
                border: 0px;
            }
        }
    }

    &.placement-side {
        flex-direction: row;

        ion-tab-bar {
            order: -1;
            width: var(--menutabbar-size);
            height: calc(100% - var(--ion-safe-area-top) - var(--ion-safe-area-bottom));
            flex-direction: column;
            @include border-end(var(--border));
            border-top: 0;
            justify-content: flex-start;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);

            @include padding(var(--ion-safe-area-top), 0px, var(--ion-safe-area-bottom), var(--ion-safe-area-left));

            ion-tab-button {
                --padding-start: 0;
                --padding-end: 0;
                // Removed side borders for cleaner look
                border: none;

                &::before {
                    width: calc(100% - 12px);
                    height: 48px;
                    border-radius: 12px;
                }

                &.tab-selected::after {
                    content: '';
                    position: absolute;
                    left: 0;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 4px;
                    height: 32px;
                    background: var(--core-tab-border-color-active);
                    border-radius: 0 4px 4px 0;
                }

                ion-badge.core-tab-badge {
                    @include position(null, 8px, null, auto);
                }
            }

            ion-tab-button, core-user-menu-button {
                width: 100%;
                min-height: calc(var(--menutabbar-size) - 8px);
                flex: 0;

                ion-icon.core-tab-badge,
                ion-badge.core-tab-badge {
                    top: calc(50% - 20px);
                }
            }
        }
    }
}

.core-network-message {
    background: var(--network-message-background);
    pointer-events: none;
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding-left: 10px;
    padding-right: 10px;
    text-align: center;
    color: white;
    visibility: hidden;
    height: 0;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0.9;
    z-index: 12;
    font-size: var(--mdl-typography-body-font-sm);
    font-weight: 500;
    letter-spacing: 0.3px;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);

    .core-online-message {
        display: var(--network-message-online);
    }

    .core-offline-message {
        display: var(--network-message-offline);
    }
}

// Smooth slide animations
.slide-in-bottom-animation {
    animation: slideInBottom 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.slide-out-bottom-animation {
    animation: slideOutBottom 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes slideInBottom {
    from {
        transform: translateY(100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slideOutBottom {
    from {
        transform: translateY(0);
        opacity: 1;
    }
    to {
        transform: translateY(100%);
        opacity: 0;
    }
}
