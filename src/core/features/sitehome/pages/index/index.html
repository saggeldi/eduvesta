<core-navbar-buttons slot="end" prepend>
    @if (searchEnabled) {
        <ion-button fill="clear" (click)="openSearch()" [ariaLabel]="'core.courses.searchcourses' | translate">
            <ion-icon name="fas-magnifying-glass" slot="icon-only" aria-hidden="true" />
        </ion-button>
    }
</core-navbar-buttons>
<ion-content>
    <ion-refresher slot="fixed" [disabled]="!dataLoaded" (ionRefresh)="doRefresh($event.target)">
        <ion-refresher-content pullingText="{{ 'core.pulltorefresh' | translate }}" />
    </ion-refresher>
    <core-loading [hideUntil]="dataLoaded" placeholderType="column" placeholderHeight="48px">

        <!-- EduVestra Hero Section -->
        <div class="eduvestra-hero">
            <div class="hero-content">
                <ion-label>
                    <h1>Modern Learning</h1>
                    <h2>EduVestra Digital School</h2>
                    <p>Safe, Accessible, and Fun Learning for Every Child</p>
                </ion-label>
                <div class="hero-actions">
                    <ion-button color="light" fill="solid" (click)="openAvailableCourses()">
                        Explore Courses
                    </ion-button>
                </div>
            </div>
            <div class="hero-decoration">
                <!-- Abstract circle or illustration could go here -->
            </div>
        </div>

        <div class="home-content-container">
            <!-- Site home main contents (Sections/Modules) -->
            @if (section && section.hasContent) {
                <section class="core-course-module-list-wrapper">
                    @if (section.name || section.visible === 0 || section.availabilityinfo) {
                        <ion-item-divider class="course-section ion-text-wrap"
                            [class.item-dimmed]="section.visible === 0 || section.uservisible === false">
                            <ion-label>
                                @if (section.name) {
                                    <h2 class="big" [id]="'core-section-name-' + section.id">
                                        <core-format-text [text]="section.name" contextLevel="course" [contextInstanceId]="siteHomeId" />
                                    </h2>
                                }
                                @if (section.visible === 0 && section.uservisible !== false) {
                                    <div>
                                        <ion-badge color="warning">
                                            {{ 'core.course.hiddenfromstudents' | translate }}
                                        </ion-badge>
                                    </div>
                                } @else if (section.visible === 0 && section.uservisible === false) {
                                    <div>
                                        <ion-badge color="warning">
                                            {{ 'core.notavailable' | translate }}
                                        </ion-badge>
                                    </div>
                                }
                                @if (section.availabilityinfo) {
                                    <div>
                                        <ion-chip class="clickable">
                                            <ion-icon name="fas-lock" [attr.aria-label]="'core.restricted' | translate" />
                                            <ion-label>
                                                <core-format-text [text]=" section.availabilityinfo" contextLevel="course"
                                                    [contextInstanceId]="siteHomeId" />
                                            </ion-label>
                                        </ion-chip>
                                    </div>
                                }
                            </ion-label>
                        </ion-item-divider>
                    }

                    @if (section.summary) {
                        <ion-item class="ion-text-wrap section-summary">
                            <ion-label>
                                <core-format-text [text]="section.summary" contextLevel="course" [contextInstanceId]="siteHomeId" />
                            </ion-label>
                        </ion-item>
                    }

                    @for (modOrSubsection of section.contents; track modOrSubsection.id) {
                        @if (isModule(modOrSubsection)) {
                            <core-course-module [module]="modOrSubsection" [section]="section" />
                        }
                    }
                </section>
            }

            <!-- Quick Access Grid -->
            <div class="quick-access-grid">
                @if (items.length > 0) {
                    @for (item of items; track item) {
                        @switch (item) {
                            @case ('LIST_OF_COURSE') {
                                <ng-template *ngTemplateOutlet="allCourseList" />
                            }
                            @case ('LIST_OF_CATEGORIES') {
                                <ng-template *ngTemplateOutlet="categories" />
                            }
                            @case ('COURSE_SEARCH_BOX') {
                                <ng-template *ngTemplateOutlet="courseSearch" />
                            }
                            @case ('ENROLLED_COURSES') {
                                <ng-template *ngTemplateOutlet="enrolledCourseList" />
                            }
                            @case ('NEWS_ITEMS') {
                                <ng-template *ngTemplateOutlet="news" />
                            }
                        }
                    }
                }
            </div>
        </div>

        @if (hasBlocks) {
            <core-block-side-blocks-button slot="fixed" contextLevel="course" [instanceId]="siteHomeId" />
        }

        @if (!hasContent) {
            <core-empty-box icon="fas-box-open" [message]="'core.course.nocontentavailable' | translate" />
        }
    </core-loading>
</ion-content>

<!-- Templates modified for Grid Layout -->

<ng-template #allCourseList>
    <ion-card class="dashboard-card card-blue" button (click)="openAvailableCourses()">
        <div class="card-icon-wrapper">
            <ion-icon name="fas-graduation-cap" aria-hidden="true" />
        </div>
        <ion-card-header>
            <ion-card-title>{{ 'core.courses.availablecourses' | translate}}</ion-card-title>
            <ion-card-subtitle>{{ 'core.view' | translate }}</ion-card-subtitle>
        </ion-card-header>
    </ion-card>
</ng-template>

<ng-template #news>
    @if (newsForumModule) {
        <div class="full-width-item">
            <h3 class="section-title">Latest News</h3>
             <core-course-module class="core-sitehome-news" [module]="newsForumModule" />
        </div>
    }
</ng-template>

<ng-template #categories>
    <ion-card class="dashboard-card card-purple" button (click)="openCourseCategories()">
        <div class="card-icon-wrapper">
            <ion-icon name="far-folder" aria-hidden="true" />
        </div>
         <ion-card-header>
            <ion-card-title>{{ 'core.courses.categories' | translate}}</ion-card-title>
             <ion-card-subtitle>{{ 'core.explore' | translate }}</ion-card-subtitle>
        </ion-card-header>
    </ion-card>
</ng-template>

<ng-template #enrolledCourseList>
    <ion-card class="dashboard-card card-teal" button (click)="openMyCourses()">
        <div class="card-icon-wrapper">
            <ion-icon name="fas-book-open" aria-hidden="true" />
        </div>
        <ion-card-header>
            <ion-card-title>{{ 'core.courses.mycourses' | translate}}</ion-card-title>
            <ion-card-subtitle>{{ 'core.continue' | translate }}</ion-card-subtitle>
        </ion-card-header>
    </ion-card>
</ng-template>

<ng-template #courseSearch>
    <ion-card class="dashboard-card card-orange" button (click)="openSearch()">
        <div class="card-icon-wrapper">
             <ion-icon name="fas-magnifying-glass" aria-hidden="true" />
        </div>
        <ion-card-header>
            <ion-card-title>{{ 'core.courses.searchcourses' | translate}}</ion-card-title>
             <ion-card-subtitle>{{ 'core.find' | translate }}</ion-card-subtitle>
        </ion-card-header>
    </ion-card>
</ng-template>
